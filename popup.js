// (popup.js code from above response, omitted here for brevity due to size)...